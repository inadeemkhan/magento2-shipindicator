<?php
declare(strict_types=1);

/**
 * Free Shipping Indicator Template
 *
 * Renders the progress bar and message showing how close the customer
 * is to achieving free shipping eligibility.
 *
 * @var \NadeemSoft\ShipIndicator\Block\Cart\Indicator $block
 */

// Render custom CSS defined in admin configuration
echo '<style>' . $block->getCustomCSS() . '</style>';
?>

<!-- Define CSS variables for dynamic values -->
<style>
:root {
    --freeship-bg-color: <?= /* @noEscape */ $block->getMessageBackground() ?>;
    --freeship-text-color: <?= /* @noEscape */ $block->getMessageTextColor() ?>;
    --freeship-font-size: <?= /* @noEscape */ $block->getFontSize() ?>px;
    --freeship-progress-color: <?= /* @noEscape */ $block->getProgressBarColor() ?>;
}
</style>

<div class="freeship-section">
    <?php if (!$block->isOrderEligibleForFreeShipping()): ?>
        <?php $freeshippingProgress = $block->getFreeShippingCompletionRate(); ?>

        <div class="freeship-indicator-wrapper">
            <!-- Minimum threshold marker -->
            <span class="min"><?= /* @noEscape */ $block->getFormattedPrice(0, 0) ?></span>

            <!-- Progress bar -->
            <div class="freeship-indicator">
                <div class="freeship-indicator-bg">
                    <div class="freeship-indicator-fill freeship-indicator-progress"
                         style="width: <?= /* @noEscape */ $freeshippingProgress ?>%;">
                    </div>
                </div>
            </div>

            <!-- Maximum threshold marker -->
            <span class="max"><?= /* @noEscape */ $block->getFormattedPrice($block->getFreeShippingMinValue(), 0) ?></span>
        </div>

        <!-- Message showing remaining amount -->
        <p class="message">
            <?= /* @noEscape */ __(
                $block->getTextMessage() . ' <span class="freeship-price">%1</span>',
                $block->getFormattedPrice($block->getFreeShippingAmountDifference())
            ) ?>
        </p>
    <?php else: ?>
        <!-- Message when order is eligible for free shipping -->
        <div class="freeship-text">
            <p><?= /* @noEscape */ __($block->getEligibleTextMessage()) ?></p>
        </div>
    <?php endif; ?>
</div>